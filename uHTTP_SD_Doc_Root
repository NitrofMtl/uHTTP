/**
   uHTTP Web server implementation with SD DOCROOT
   Check if file exists on SD and render it.

   This example code is in the public domain.
 **/
#include <SD.h>
#include <SPI.h>
#include <Ethernet.h>
#include <uHTTP.h>



#define SDC_PIN 4
#define default_page "index.htm"  //set the default page to load on request

byte macaddr[6] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x66};
byte ip4addr[4] = {192, 168, 0, 110};

uHTTP *server = new uHTTP(80);
EthernetClient response;


void setup() {
  Serial.begin(9600);

  Serial.print("Initializing SD card...\t\t");
  pinMode(SDC_PIN, OUTPUT);
  digitalWrite(SDC_PIN, HIGH);
  if (!SD.begin(SDC_PIN)) {
    Serial.println("[FAIL]");
    return;
  }
  Serial.println("[DONE]");

  Ethernet.begin(macaddr, ip4addr);

  Serial.print("Starting uHTTP at ");
  Serial.print(Ethernet.localIP());
  Serial.println(":80");

  server->begin();
}

void loop() {
  if ((response = server->available())) {
    char url[32];
    if (server->uri("/")) strcpy(url, default_page); // if nothing requested, send default page
    else strcpy(url, server->uri());

    server->webFile_Post(url,  response);// if file exist on sd card, post it to client
    response.stop();
  }
}
